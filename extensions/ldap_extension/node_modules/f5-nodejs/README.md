The f5 module for node.js is used to access the ILX features of BIG-IP.  Use
it to program the high-performance BIG-IP datapath from node.js.

# Introduction 

You can handle ILX events from iRules via a node.js program like this:

    var f5 = require('f5');

    var methods = {
      'foo' : function (req, res) {
        console.log('foo called');
        res.reply('bar');
      }
    };

    var server = f5.createILXServer(methods);
    server.listen();

and call it from iRules like this:

    FIXME(andrew): Corresponding iRules

# f5.createILXServer(methods, [options])

Creates a new ILX server to accept ILX calls from iRules.

The argument `methods` specifies a mapping of ILX calls that the server
supports.  Each key is the name of the method, and the value is a function that
implements that method.  See [ILXServer.addMethod()][] for details on how
methods are invoked. For example:

    var methods = {
      'callWithReply' : function (req, res) {
        console.log('callWithReply');
        res.reply('bar');
      },
      'notify' : function (req) {
        console.log('notify');
        // notifications don't get replies
      },
    };
    var server = f5.createILXServer(methods, { timeout: 2.5 });

There is a default method handler that can be specified by either the
`defaultMethod` option, or via [ILXServer.setDefaultMethod()][].  If the
client invokes a method with a name that does not match any of the registered
methods, this method is invoked instead.  If this method is not provided and
the client has asked for a reply, it will receive an error reply with error
code `30` and message `method not found`.

An optional argument `options` can be passed that specifies these options:

  - `timeout`: How long the ILXServer should wait on an idle connection with an
    ILX client.  Once the connection is idle for a period of `timeout` seconds,
the ['timeout'][] event is emitted and the connection destroyed if the event is
not handled.  Default value is `5.0` seconds.
  - `defaultMethod`: A method that is invoked if the client invokes a method
    that does not match any of the other method handlers.

# Class: f5.ILXServer

This class is the ILX Server that handles ILX calls from iRules (client).
Create one using [f5.createILXServer()][].

f5.ILXServer is a `net.Server` (from the base node.js API), so it supports
methods like `close()` and `listen()` and emits events like `'close'` and
`'listening'`.  It also supports the additional methods and events below.

## ILXServer.addMethod(name, callback)

Adds a method with the name `name` to the server.  When a client calls this
method, the `callback` is invoked.

Callback will be invoked with one argument `request` if the client called this
method as a notification (no return data).  Callback will be invoked with two
arguments `request, response` if the client called this method as a
non-notification (return data).  `request` is an [f5.ILXRequest][], `response`
is an [f5.ILXResponse][].

You can check whether the client called as a notification by checking the
second argument, for example:

    function handleMethodFoo(request, response) {
      if (response) {
        console.log('Method called expecting reply');
        response.reply('this is my reply');
      } else {
        console.log('Method called as notification (no reply)');
      }
    }

or

    function handleMethodFoo(request, response) {
      if (arguments.length === 2) {
        console.log('Method called expecting reply');
        response.reply('this is my reply');
      } else {
        console.log('Method called as notification (no reply)');
      }
    }

## ILXServer.removeMethod(name)

Removes the method named `name` from the server if it exists.

## ILXServer.setDefaultMethod([callback])

Sets the method that is called if the client invokes a method that does not
match any of the registered method handlers.  Call with no arguments to remove
the default method handler.

## Event: 'timeout'

Emitted if the connection to the ILX client is idle for the `timeout` period
specified as an option when then ILXServer was created.  This can happen in two
conditions: an ILX client has connected, but is idle instead of sending an ILX
method invocation, or an ILX client has invoked a method in your script, but
your script has not replied.

If your script handles this event, the ILXServer takes no action: it is just a
notification.  If your script does not have a listener for this event, then the
ILXServer destroys the connection to the client.

# Class: f5.ILXRequest

This class is created automatically and passed as an argument to methods on the
[f5.ILXServer][].

## ILXRequest.method()

Returns the name of the method that was invoked.

## ILXRequest.params()

Returns the parameters that the client specified when invoking the method.

    FIXME(andrew): An example of params here.

# Class: f5.ILXResponse

This class is created automatically and passed as an argument to methods on the
[f5.ILXServer][] if they were invoked not as a notification.

## ILXResponse.reply(params)

Send a response to the request.  `params` is an object or value that can be
serialized using JSON.stringify().  Example:

    function handleMethod(request, response) {
      if (request.params === 'replyString') {
        response.reply('this string can be converted with JSON.stringify()');
      } else if (request.params === 'replyArray') {
        response.reply([ 'a', 'b', 'c']);
      } else if (request.params === 'replyObject') {
        response.reply({ 'a' : 1, 'embeddedArray' : [ 'x', 'y', 'z' ]});
      }
    }

# License

Copyright (C) F5 Networks, Inc. 2014

No part of this software may be reproduced or transmitted in any
form or by any means, electronic or mechanical, for any purpose,
without express written permission of F5 Networks, Inc.

[ILXServer.addMethod()]: #ilxserver_addmethod_name_callback
[f5.createILXServer()]: #f5_createilxserver_methods_options
[f5.ILXServer]: #class_f5_ilxserver
[f5.ILXRequest]: #class_f5_ilxrequest
[f5.ILXResponse]: #class_f5_ilxresponse
['timeout']: #event_timeout
[ILXServer.setDefaultMethod()]: #ilxserver_setdefaultmethod_callback
